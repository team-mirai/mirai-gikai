# Dependency Audit Report

**Date:** 2026-01-10
**Total node_modules size:** 858MB
**Total packages:** 670

---

## 1. Security Vulnerabilities (4 Moderate)

### 1.1 PrismJS DOM Clobbering (MODERATE)
- **Package:** `prismjs` < 1.30.0
- **Path:** `web > react-syntax-highlighter > refractor > prismjs`
- **Advisory:** <https://github.com/advisories/GHSA-x7hr-w5r2-h6wg>
- **Recommendation:** Update `react-syntax-highlighter` or override prismjs version

### 1.2 Vite server.fs.deny Bypass (MODERATE)
- **Package:** `vite` 7.1.0 - 7.1.10
- **Path:** `web > vitest > vite`
- **Advisory:** <https://github.com/advisories/GHSA-93m4-6634-74q7>
- **Recommendation:** Update `vitest` to latest version (auto-updates vite)

### 1.3 node-tar Race Condition (MODERATE)
- **Package:** `tar` = 7.5.1
- **Path:** `admin > @tailwindcss/postcss > @tailwindcss/oxide > tar`
- **Advisory:** <https://github.com/advisories/GHSA-29xp-372q-xqph>
- **Recommendation:** Wait for @tailwindcss/oxide update or add override

### 1.4 mdast-util-to-hast Unsanitized Class (MODERATE)
- **Package:** `mdast-util-to-hast` 13.0.0 - 13.2.0
- **Path:** `web > react-markdown > mdast-util-to-hast`
- **Advisory:** <https://github.com/advisories/GHSA-4fh9-h7wg-q85m>
- **Recommendation:** Update `react-markdown` to get patched mdast-util-to-hast

---

## 2. Outdated Root Packages

| Package | Current | Latest | Priority |
|---------|---------|--------|----------|
| @biomejs/biome | 2.2.5 | 2.3.11 | Low (minor) |
| dotenv-cli | 7.4.4 | 11.0.0 | Low (major - review breaking changes) |
| lint-staged | 15.5.2 | 16.2.7 | Low (major - review breaking changes) |

---

## 3. Version Inconsistencies

### 3.1 @supabase/supabase-js

| Location | Version in package.json |
|----------|-------------------------|
| admin | ^2.57.0 |
| packages/supabase | ^2.45.4 |
| packages/seed | ^2.45.4 |

**Recommendation:** Align to latest version (^2.57.0 or newer) in packages/supabase only, as admin and seed should use workspace dependency.

### 3.2 zod

| Location | Version in package.json |
|----------|-------------------------|
| admin | ^4.1.5 |
| web | ^4.1.12 |

**Recommendation:** Align to ^4.1.12 in both.

### 3.3 @types/node

| Location | Version |
|----------|---------|
| web, admin | ^20 |
| packages/supabase, packages/seed | ^22.5.5 |

**Recommendation:** Keep ^20 for web/admin (matches CI Node.js 20), align packages to ^20 for consistency.

### 3.4 typescript

| Location | Version |
|----------|---------|
| web, admin | ^5 |
| packages/supabase | ^5.6.2 |
| packages/seed | ^5.0.0 |

**Recommendation:** Align to ^5.6.2 or ^5 across all packages.

---

## 4. Duplicate Dependencies (Potential for Extraction)

The following packages are duplicated between `web` and `admin`:

| Package | Used In |
|---------|---------|
| @supabase/ssr | web, admin, packages/supabase |
| class-variance-authority | web, admin |
| clsx | web, admin |
| lucide-react | web, admin |
| tailwind-merge | web, admin |
| next | web, admin |
| react / react-dom | web, admin |
| nextjs-toploader | web, admin |
| @radix-ui/react-popover | web, admin |
| @radix-ui/react-select | web, admin |
| @radix-ui/react-slot | web, admin |
| @radix-ui/react-switch | web, admin |

**Recommendation:** Consider creating a shared `packages/ui` package for common UI components and utilities to reduce duplication and ensure consistency.

---

## 5. Potential Bloat Analysis

### 5.1 Langfuse Packages
- `langfuse` (3.38.5)
- `langfuse-vercel` (3.38.5)

**Question:** Both are installed. If using Vercel AI SDK integration, `langfuse-vercel` may be sufficient alone.

### 5.2 Heavy Markdown Pipeline
Web package has extensive markdown processing:
- `react-markdown`
- `react-syntax-highlighter`
- `rehype-sanitize`
- `rehype-stringify`
- `remark-breaks`
- `remark-parse`
- `remark-rehype`
- `hast-util-to-jsx-runtime`
- `unified`
- `unist-util-visit`
- `streamdown`

**Recommendation:** This is likely necessary for the application's Markdown rendering needs. No action needed unless features are unused.

### 5.3 @opentelemetry/sdk-node
This package adds significant dependencies. Verify it's actively used for observability.

---

## 6. Recommended Actions

### High Priority (Security)
1. **Fix vitest vulnerability:**
   ```bash
   pnpm --filter web update vitest @vitest/ui
   ```

2. **Fix react-markdown vulnerability:**
   ```bash
   pnpm --filter web update react-markdown
   ```

3. **Add override for prismjs** (if react-syntax-highlighter doesn't update):
   Add to root `package.json`:
   ```json
   "pnpm": {
     "overrides": {
       "prismjs": ">=1.30.0"
     }
   }
   ```

4. **Add override for tar** (if tailwindcss doesn't update):
   ```json
   "pnpm": {
     "overrides": {
       "tar": ">=7.5.2"
     }
   }
   ```

### Medium Priority (Consistency)
5. **Run pnpm dedupe:**
   ```bash
   pnpm dedupe
   ```

6. **Align @supabase/supabase-js versions:**
   - Update `packages/supabase/package.json` to `^2.57.0`
   - Update `packages/seed/package.json` to `^2.57.0`

7. **Align zod versions:**
   - Update `admin/package.json` zod to `^4.1.12`

8. **Align @types/node versions:**
   - Keep ^20 for web/admin (matches CI)
   - Update packages to ^20 for consistency

### Low Priority (Maintenance)
9. **Update Biome:**
   ```bash
   pnpm update @biomejs/biome
   ```

10. **Review major version updates:**
    - `dotenv-cli` 7 → 11 (check breaking changes)
    - `lint-staged` 15 → 16 (check breaking changes)

---

## 7. Future Considerations

1. **Shared UI Package:** Extract common UI dependencies (Radix, CVA, clsx, lucide-react) to `packages/ui`

2. **Dependency Bot:** Consider using Renovate or Dependabot for automated updates

3. **Bundle Analysis:** Run `next build --analyze` to identify client bundle optimization opportunities
