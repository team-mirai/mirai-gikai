# 開発用UIプレビュー環境（/dev routes）

## 概要

Next.js の App Router 内に `/dev/*` ルートを設け、コンポーネントを単体でプレビューできる開発専用環境。

**目的:**

- 動線の深い場所にあるコンポーネントを、ページ遷移なしで確認・微調整できる
- LLM（Chrome DevTools MCP）からも `localhost:3000/dev` に直接アクセスして確認可能
- Storybook 等の外部ツールを導入せず、Server Components もそのまま動作する

## アクセス方法

```bash
pnpm dev
# http://localhost:3000/dev にアクセス
```

本番環境では middleware により `/dev/*` は 404 を返す（`web/src/middleware.ts`）。

## ディレクトリ構成

```
web/src/app/
├── layout.tsx              # ルートレイアウト（html, body, fonts のみ）
├── (main)/                 # 本番用ルートグループ（Header/Footer/AuthGate）
│   ├── layout.tsx
│   ├── page.tsx
│   ├── bills/...
│   └── ...
└── dev/                    # 開発用プレビュー
    ├── layout.tsx           # サイドバーナビ付きレイアウト
    ├── page.tsx             # コンポーネント一覧（インデックス）
    ├── _components/
    │   ├── dev-sidebar.tsx       # サイドバーナビゲーション
    │   ├── component-showcase.tsx # コンポーネント表示ラッパー
    │   └── preview-section.tsx    # バリアント表示セクション
    ├── _lib/
    │   ├── registry.ts      # プレビューページのレジストリ
    │   └── mock-data.ts     # 共有モックデータ
    ├── ui/
    │   └── page.tsx         # UIプリミティブ一覧
    └── features/
        └── bills/
            ├── bill-card/page.tsx
            └── bill-status-badge/page.tsx
```

### ルートグループ `(main)` について

ルートの `layout.tsx` は `<html>`, `<body>`, フォント, `globals.css` のみを担当する。Header / Footer / AuthGate / Analytics は `(main)/layout.tsx` に分離されており、`/dev` ルートにはこれらが適用されない。URL は `(main)` の影響を受けず従来通り。

## プレビューページの追加方法

### 1. registry にエントリを追加

`web/src/app/dev/_lib/registry.ts` に追加:

```ts
{
  path: "/dev/features/bills/new-component",
  label: "NewComponent",
  description: "新しいコンポーネントの説明",
}
```

### 2. page.tsx を作成

`web/src/app/dev/features/bills/new-component/page.tsx`:

```tsx
import { NewComponent } from "@/features/bills/client/components/new-component";
import { ComponentShowcase } from "../../../_components/component-showcase";
import { PreviewSection } from "../../../_components/preview-section";

export default function NewComponentPreview() {
  return (
    <ComponentShowcase title="NewComponent" description="説明">
      <PreviewSection label="Default">
        <NewComponent {...mockProps} />
      </PreviewSection>
    </ComponentShowcase>
  );
}
```

### 3. モックデータが必要な場合

`web/src/app/dev/_lib/mock-data.ts` にモックオブジェクトやファクトリ関数を追加。

### データ戦略

| パターン | 用途 | 例 |
|----------|------|----|
| Props-only | Client Components にモックデータを渡す | BillCard, BillStatusBadge |
| 実データ + fallback | Server Components で loader を呼び、失敗時はモックに fallback | FeaturedBillSection |
| モック専用 | 特定の状態を再現 | 各ステータスの表示確認 |

## 共通コンポーネント

- **`ComponentShowcase`**: タイトル・説明付きのコンポーネント表示枠
- **`PreviewSection`**: ラベル付きのバリアント表示セクション
- **`DevSidebar`**: 左サイドバーナビゲーション（registry から自動生成）
